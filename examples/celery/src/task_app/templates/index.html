<!doctype html>
<html>
<head>
  <meta charset=UTF-8>
  <title>Celery Example</title>
</head>
<body>
<h2>Celery Example</h2>
Execute background tasks with Celery. Submits tasks and shows results using JavaScript.

<hr>
<h4>Add</h4>
<p>Start a task to add two numbers, then poll for the result.
<form id=add method=post action="{{ url_for("tasks.add") }}">
  <label>A <input type=number name=a value=4></label><br>
  <label>B <input type=number name=b value=2></label><br>
  <input type=submit>
</form>
<p>Result: <span id=add-result></span></p>

<hr>
<h4>Block</h4>
<p>Start a task that takes 5 seconds. However, the response will return immediately.
<form id=block method=post action="{{ url_for("tasks.block") }}">
  <input type=submit>
</form>
<p id=block-result></p>

<hr>
<h4>Process</h4>
<p>Start a task that counts, waiting one second each time, showing progress.
<form id=process method=post action="{{ url_for("tasks.process") }}">
  <label>Total <input type=number name=total value="10"></label><br>
  <input type=submit>
</form>
<p id=process-result></p>

<script>
  document.forms["add"].addEventListener("submit", (event) => {
    event.preventDefault()
    fetch(event.target.action, {
      method: "POST",
      body: new FormData(event.target)
    })
      .then(response => response.json())
      .then(console.log)
  })

  document.forms["block"].addEventListener("submit", (event) => {
    event.preventDefault()
    fetch(event.target.action, {method: "POST"})
      .then(response => response.json())
      .then(console.log)
  })

  document.forms["process"].addEventListener("submit", (event) => {
    event.preventDefault()
    fetch(event.target.action, {
      method: "POST",
      body: new FormData(event.target)
    })
      .then(response => response.json())
      .then(console.log)
  })
</script>
</body>
</html>
